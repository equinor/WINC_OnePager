
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../well_class/">
      
      
        <link rel="next" href="../models/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.34">
    
    
      
        <title>Well pressure - WINC_OnePager</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.35f28582.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#src.WellClass.libs.well_pressure.pressure" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="WINC_OnePager" class="md-header__button md-logo" aria-label="WINC_OnePager" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            WINC_OnePager
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Well pressure
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="WINC_OnePager" class="md-nav__button md-logo" aria-label="WINC_OnePager" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    WINC_OnePager
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User Guides
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../well_class/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WellClass
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developer Guides
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Developer Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mkdocs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MkDocs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../INSTALLATION/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Code References
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Code References
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_3_1" id="__nav_3_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    WellClass
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3_1">
            <span class="md-nav__icon md-icon"></span>
            WellClass
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../well_class/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Well class
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Well pressure
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Well pressure
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.WellClass.libs.well_pressure.pressure" class="md-nav__link">
    <span class="md-ellipsis">
      pressure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pressure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.WellClass.libs.well_pressure.pressure.Pressure" class="md-nav__link">
    <span class="md-ellipsis">
      Pressure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pressure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.WellClass.libs.well_pressure.pressure.Pressure.init_pressure_curves" class="md-nav__link">
    <span class="md-ellipsis">
      init_pressure_curves
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.WellClass.libs.well_pressure.pressure.Pressure.check_init_pressure" class="md-nav__link">
    <span class="md-ellipsis">
      check_init_pressure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.WellClass.libs.well_pressure.pressure.Pressure.check_scenarios_from_input" class="md-nav__link">
    <span class="md-ellipsis">
      check_scenarios_from_input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.WellClass.libs.well_pressure.pressure.Pressure.compute_barrier_leakage" class="md-nav__link">
    <span class="md-ellipsis">
      compute_barrier_leakage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Models
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.WellClass.libs.well_pressure.pressure" class="md-nav__link">
    <span class="md-ellipsis">
      pressure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pressure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.WellClass.libs.well_pressure.pressure.Pressure" class="md-nav__link">
    <span class="md-ellipsis">
      Pressure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pressure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.WellClass.libs.well_pressure.pressure.Pressure.init_pressure_curves" class="md-nav__link">
    <span class="md-ellipsis">
      init_pressure_curves
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.WellClass.libs.well_pressure.pressure.Pressure.check_init_pressure" class="md-nav__link">
    <span class="md-ellipsis">
      check_init_pressure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.WellClass.libs.well_pressure.pressure.Pressure.check_scenarios_from_input" class="md-nav__link">
    <span class="md-ellipsis">
      check_scenarios_from_input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.WellClass.libs.well_pressure.pressure.Pressure.compute_barrier_leakage" class="md-nav__link">
    <span class="md-ellipsis">
      compute_barrier_leakage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Well pressure</h1>

<div class="doc doc-object doc-module">



<h2 id="src.WellClass.libs.well_pressure.pressure" class="doc doc-heading">
            <code>src.WellClass.libs.well_pressure.pressure</code>


<a href="#src.WellClass.libs.well_pressure.pressure" class="headerlink" title="Permanent link"></a></h2>

    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="src.WellClass.libs.well_pressure.pressure.Pressure" class="doc doc-heading">
            <code>Pressure</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#src.WellClass.libs.well_pressure.pressure.Pressure" class="headerlink" title="Permanent link"></a></h3>


    <div class="doc doc-contents ">


        <p>This is used to compute leakeage rate of legacy well</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code>header</code></b>
              (<code>dict</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>well header</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code>reservoir_P</code></b>
              (<code>dict</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>reservoir pressure</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code>co2_datum</code></b>
              (<code>float</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>co2 datum depth</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code>pvt_path</code></b>
              (<code>str</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>directory where PVT files are located.</p>
          </div>
        </li>
    </ul>

              <details class="quote">
                <summary>Source code in <code>src/WellClass/libs/well_pressure/pressure.py</code></summary>
                <pre class="highlight"><code class="language-python">@dataclass              # @dataclass(kw_only=True)
class Pressure:
    """ This is used to compute leakeage rate of legacy well

        Args:
            header (dict): well header
            reservoir_P (dict): reservoir pressure
            co2_datum (float): co2 datum depth
            pvt_path (str): directory where PVT files are located.            
    """
    header          : dict = None
    reservoir_P     : dict = None    
    co2_datum       : dict = None
    pvt_path        : Union[str, Path] = None
    barriers        : dict = None
    max_pressure_pos: Union[dict, list, float, int] = None
    pressure_scenarios : dict = None
    mixture_name   :  str = None
    mixture_composition   :  str = None

    def __post_init__(self):
        self._get_mixture_info()
        self.init_pressure_curves()
        self.check_init_pressure()
        self._init_CO2_pressures_table()
        self.check_scenarios_from_input()


    # TODO(hzh): non-pure function!!!
    def _get_mixture_info(self):

        if isinstance(self.pvt_path, str):
            pvt_path = Path(self.pvt_path)
        else:
            pvt_path = self.pvt_path

        with open(pvt_path / "metadata.json", "r") as file:
            mixture_info = json.load(file)

        self.mixture_name = mixture_info['name']
        self.mixture_composition = mixture_info['composition']
        print(f'Computing pressures for {self.mixture_name} ({self.mixture_composition})')


    def init_pressure_curves(self):
        '''
        Initiates Pressure table for the wellbore
        By default creates a hydrostatic gradient curve and a Sh min curve
        '''

        #Calculate depth, temp(depth) hydrostatic_pressure(depth), H2ORHO(depth for hydrostatic pressure)
        init_curves = get_hydrostatic_P(self.header, pvt_path=self.pvt_path) 

        #Include Minimum horizontal stress
        init_curves = _get_shmin(self.header, init_curves)

        #Store tables in main pressure_CO2 table 
        self.init_curves = init_curves

    def check_init_pressure(self):
        '''
        Calculates hydrostatic pressure at reservoir_P['depth_msl'] and stores it in reservoir_P['hydrostatic_pressure']

        reservoir_pressure		
        depth_msl	RP1	RP2
        2238		        20

        then P_init['depth_msl'] is the reference depth 2238

        Also delta-pressures RP1 and RP2 are read and used later for leakage calculations. (self.reservoir_P[])

        Note: The interpretation of the numbers set for RP1 and RP2 is a bit unclear. 
              RP means reservoir pressure - but for the current implementation 
              it is interpreted as delta pressure: delta wrt hydrostatic pressure. 
              Initial implementation had the possibility to have absolute pressure AND a delta-pressure. But the delta-pressure had to be 
              given as a string "+ 20" or "- 15". Bit the + and - tended to create problems. 
              So alternatively one could distingwuish between RP and DP  if it is important to give in absolute pressure as well.
              But the most interesting input IS actually the change in pressure compared with hydrostatic pressure.

        '''
        # If no reservoir pressure is given, then we assume the reservoir is at the CO2 datum
        if self.reservoir_P is None:
            self.reservoir_P = {'depth_msl': self.co2_datum}

        #Get initial pressure table from reservoir_P dictionary
        P_init = self.reservoir_P

        # Get reference depth from reservoir_P, e.g. top reservoir
        ref_z        = P_init['depth_msl']                       


        #Hydrostatic pressure at reference depth (ref_z)
        ref_p        = np.interp(ref_z, self.init_curves['depth_msl'], self.init_curves[ 'hs_p'])
        print(f"Hydrostatic pressure at reference depth {ref_z:.0f} is {ref_p:.2f}")

        #Store value in reservoir_P table
        self.reservoir_P['hydrostatic_pressure'] = float(ref_p)



    def _init_pressure_scenarios_dict(self):
        '''
        Returns a dictionary with default values for a new pressure scenario
        '''
        # Define the default dictionary
        default_dict = {
            'name': None,
            'z_MSAD': None,
            'from_resrvr': None,
            'p_MSAD': None,
            'p_resrv': None,
            'z_resrv': None,
            'p_delta': None
        }

        self.pressure_scenarios = defaultdict(lambda: default_dict.copy())

    def _init_CO2_pressures_table(self):
         #Define and assign a multiindex that groups columns generic for all scenarios: depth_msl, temp, hs_p, RHOH2O and Shmin 
        index_init = pd.MultiIndex.from_product([['init'], self.init_curves.columns])
        self.pressure_CO2 = self.init_curves.copy()
        self.pressure_CO2.columns = index_init


    def check_scenarios_from_input(self):
        '''
        Reads input scenarios and creates a dictionary of scenarios to compute pressures for
        '''
        #Initialize dictionary of scenarios
        self._init_pressure_scenarios_dict()

        MAX_PRESSURE_NAME = 'max_p'

        #Get hydrostatic pressure at reservoir depth
        ref_p = self.reservoir_P['hydrostatic_pressure']

        #Compute number of scenarios
        n_scenarios = max(len(self.reservoir_P)-2, 0)

        #Initialize scenario counter
        scenario_counter = 0

        #If no scenarios are given, then we have at least one scenario: hydrostatic pressure
        self._add_hydrostatic_scenario(scenario_counter, ref_p)

        #Increment scenario counter
        scenario_counter += 1

        #Iterate over input scenarios
        if n_scenarios &gt; 0:
            scenario_counter = self._add_input_scenarios(scenario_counter, ref_p)

        #Iterate over maximum pressure scenarios
        if not self.max_pressure_pos is None:
            self._add_max_pressure_scenarios(scenario_counter, MAX_PRESSURE_NAME)



    def _add_hydrostatic_scenario(self, scenario_counter, ref_p):
        '''
        Include hydrostatic pressure scenario to pressure_scenarios dictionary
        '''
        self.pressure_scenarios[scenario_counter]['name'] = 'hydrostatic'
        self.pressure_scenarios[scenario_counter]['p_resrv'] = ref_p
        self.pressure_scenarios[scenario_counter]['from_resrvr'] = True
        self.pressure_scenarios[scenario_counter]['z_resrv'] = self.reservoir_P['depth_msl']
        self.pressure_scenarios[scenario_counter]['p_delta'] = 0

        sc_pressure = self._compute_scenario_profiles(self.pressure_scenarios[scenario_counter])

        self.pressure_scenarios[scenario_counter]['p_MSAD'] = sc_pressure.p_MSAD
        self.pressure_scenarios[scenario_counter]['z_MSAD'] = sc_pressure.z_MSAD

    def _add_input_scenarios(self, scenario_counter, ref_p):
        '''
        If more scenarios are included in input data, then they are added to the pressure_scenarios dictionary
        '''
        keys_to_skip = {'depth_msl', 'hydrostatic_pressure'}
        first_as_hydrostatic = False

        for sc_name, sc_pressure in self.reservoir_P.items():
            if sc_name in keys_to_skip:
                continue

            if sc_pressure is None or (isinstance(sc_pressure, float) and math.isnan(sc_pressure)):
                if not first_as_hydrostatic:

                    self.pressure_scenarios[0]['name'] = sc_name


                    self.pressure_CO2.columns = self.pressure_CO2.columns.set_levels(
                        self.pressure_CO2.columns.levels[0].str.replace('hydrostatic', sc_name), level=0)

                    first_as_hydrostatic = True
                continue

            magnitude = self._parse_pressure_magnitude(sc_pressure)
            p_resrv = ref_p + magnitude
            self.pressure_scenarios[scenario_counter]['name'] = sc_name
            self.pressure_scenarios[scenario_counter]['p_resrv'] = p_resrv
            self.pressure_scenarios[scenario_counter]['z_resrv'] = self.reservoir_P['depth_msl']
            self.pressure_scenarios[scenario_counter]['from_resrvr'] = True
            self.pressure_scenarios[scenario_counter]['p_delta'] = magnitude

            sc_pressure = self._compute_scenario_profiles(self.pressure_scenarios[scenario_counter])

            self.pressure_scenarios[scenario_counter]['p_MSAD'] = sc_pressure.p_MSAD
            self.pressure_scenarios[scenario_counter]['z_MSAD'] = sc_pressure.z_MSAD



            scenario_counter += 1

        return scenario_counter

    def _parse_pressure_magnitude(self, sc_pressure):
        '''
        Parses pressure magnitude from string to float
        '''
        try:
            if isinstance(sc_pressure, str):
                sc_pressure = sc_pressure.replace(" ", "")
            return float(sc_pressure)
        except Exception:
            return sc_pressure

    def _add_max_pressure_scenarios(self, scenario_counter, MAX_PRESSURE_NAME):
        '''
        Includes maximum pressure scenarios in the pressure_scenarios dictionary
        Maximum pressure scenarios are calculated from the Shmin values at specific depths above the reservoir
        '''
        # Determine the iterable based on the type of self.max_pressure_pos
        # Check if max_pressure_pos is a dictionary of barriers
        if isinstance(self.max_pressure_pos, dict):  
            print(f'max_pressure_pos is a dictionary of barriers')
            iterable = [(self.max_pressure_pos['bottom_msl'][idx], key) for idx, key in self.max_pressure_pos['barrier_name'].items()]

        # Check if max_pressure_pos is a depth value or a list of depths
        elif isinstance(self.max_pressure_pos, (list, float, int)):
            print(f'max_pressure_pos is a value')
            if isinstance(self.max_pressure_pos, (float, int)):  # Make it a list with one element
                self.max_pressure_pos = [self.max_pressure_pos]
            iterable = [(depth, f"at_{int(depth)}") for depth in self.max_pressure_pos]
        else:
            raise ValueError("Invalid type for max_pressure_pos")

        # Process the iterable
        for barr_depth, key in iterable:
            sc_name = f"{MAX_PRESSURE_NAME}_{key}"
            self.pressure_scenarios[scenario_counter]['name'] = sc_name
            self.pressure_scenarios[scenario_counter]['z_MSAD'] = barr_depth
            self.pressure_scenarios[scenario_counter]['from_resrvr'] = False

            sc_pressure = self._compute_scenario_profiles(self.pressure_scenarios[scenario_counter])

            self.pressure_scenarios[scenario_counter]['p_MSAD'] = sc_pressure.p_MSAD
            self.pressure_scenarios[scenario_counter]['p_resrv'] = sc_pressure.p_resrv
            self.pressure_scenarios[scenario_counter]['z_resrv'] = sc_pressure.z_resrv 
            self.pressure_scenarios[scenario_counter]['p_delta'] = sc_pressure.p_delta

            scenario_counter += 1


    def _compute_scenario_profiles(self, pressure_scenario: dict):
        #Retrieve pressure, temperature and density fields for CO2 and H2O
        pvt_T, pvt_P, pvt_RHO_CO2, pvt_RHO_H2O =  get_pvt(self.pvt_path)        

        #An interpolator. Used later to look-up densities given pressure p and temperature t
        get_rho_h2o = RectBivariateSpline(pvt_P, pvt_T, pvt_RHO_H2O)
        get_rho_co2 = RectBivariateSpline(pvt_P, pvt_T, pvt_RHO_CO2)

        sc_pressure = FluidP_scenario(**pressure_scenario)
        sc_pressure.compute_pressure_profile(init_table = self.init_curves,
                                             well_header = self.header,
                                             rho_co2_getter = get_rho_co2,
                                             rho_h2o_getter = get_rho_h2o,
                                             z_co2_datum = self.co2_datum)



        self._merge_scenario_profiles(sc_pressure)

        return sc_pressure




    def _merge_scenario_profiles(self, sc_pressure: FluidP_scenario):

        #Drop repeated columns
        sc_pressure.P_table = sc_pressure.P_table.drop(columns = self.pressure_CO2['init'].columns)

        #Setup multiindex
        index_table = pd.MultiIndex.from_product([[sc_pressure.name], sc_pressure.P_table.columns])
        sc_pressure.P_table.columns = index_table

        #Concatenate init table with scenario table
        self.pressure_CO2 = pd.concat([self.pressure_CO2, sc_pressure.P_table], axis= 1)




    def compute_barrier_leakage(self, well: Well, barrier_name: str) -&gt; pd.DataFrame:
        """ Compute leakage rate from the given barrier

            Args:
                well (Well): well information
                barrier_name (str): barrier to check the leakage rate
        """
        if well.inventory['barriers']:
            # for convenience
            barrier_perm = well.barrier_perm

            # barrier geometries
            barrier_props = well.compute_barrier_props(barrier_name)

            # Estimate CO2 leakage in [tons/day] after a trancient period
            barrier_leakage = compute_barrier_leakage(barrier_perm, self.pressure_scenarios, self.pressure_CO2, barrier_props)

            return barrier_leakage

        else:
            print(f'No barriers declared in well {well.header["well_name"]}')

    def create_pressure_scenario(self, name: str = None, z_MSAD: float = None, from_resrvr: bool = None, p_MSAD: float = None, p_resrv: float = None, z_resrv: float = None, p_delta: float = None):
        scenario_counter = len(self.pressure_scenarios)
        self.pressure_scenarios[scenario_counter] = {
            'name': name,
            'z_MSAD': z_MSAD,
            'from_resrvr': from_resrvr,
            'p_MSAD': p_MSAD,
            'p_resrv': p_resrv,
            'z_resrv': z_resrv,
            'p_delta': p_delta
        }

        if name is None:
            raise ValueError("The 'name' parameter is required.")

        if from_resrvr is None:
            raise ValueError("The 'from_resrvr' parameter is required.")

        if from_resrvr:
            if p_delta is None and (p_resrv is None or z_resrv is None):
                raise ValueError("If 'from_resrvr' is True, you must provide either 'p_delta' or both 'p_resrv' and 'z_resrv'.")

            if p_resrv is not None and z_resrv is not None:
                # Interpolate hydrostatic pressure at z_resrv
                hydrostatic_pressure = np.interp(z_resrv, self.init_curves['depth_msl'], self.init_curves['hs_p'])

                self.pressure_scenarios[scenario_counter]['p_delta'] = p_resrv - hydrostatic_pressure
            elif p_delta is not None and z_resrv is not None:
                # Interpolate hydrostatic pressure at z_resrv
                hydrostatic_pressure = np.interp(z_resrv, self.init_curves['depth_msl'], self.init_curves['hs_p'])


                self.pressure_scenarios[scenario_counter]['p_resrv'] = hydrostatic_pressure + p_delta

            elif p_delta is not None:
                # Use self.co2_datum as z_resrv
                print('TESTING')
                z_resrv = self.co2_datum
                hydrostatic_pressure = np.interp(z_resrv, self.init_curves['depth_msl'], self.init_curves['hs_p'])
                self.pressure_scenarios[scenario_counter]['p_resrv'] = hydrostatic_pressure + p_delta
                self.pressure_scenarios[scenario_counter]['z_resrv'] = z_resrv
            else:
                raise ValueError("Invalid combination of parameters for 'from_resrvr' = True.")
        else:
            if z_MSAD is None:
                raise ValueError("If 'from_resrvr' is False, you must provide 'z_MSAD'.")


        sc_pressure = self._compute_scenario_profiles(self.pressure_scenarios[scenario_counter])

        self.pressure_scenarios[scenario_counter]['p_MSAD'] = sc_pressure.p_MSAD
        self.pressure_scenarios[scenario_counter]['z_MSAD'] = sc_pressure.z_MSAD
        self.pressure_scenarios[scenario_counter]['p_delta'] = sc_pressure.p_delta
        self.pressure_scenarios[scenario_counter]['p_resrv'] = sc_pressure.p_resrv
        self.pressure_scenarios[scenario_counter]['z_resrv'] = sc_pressure.z_resrv

    @property
    def to_json(self):
        return json.dumps(self.__dict__, indent=4)</code></pre>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.WellClass.libs.well_pressure.pressure.Pressure.init_pressure_curves" class="doc doc-heading">
            <code class="highlight language-python">init_pressure_curves()</code>

<a href="#src.WellClass.libs.well_pressure.pressure.Pressure.init_pressure_curves" class="headerlink" title="Permanent link"></a></h4>


    <div class="doc doc-contents ">

        <p>Initiates Pressure table for the wellbore
By default creates a hydrostatic gradient curve and a Sh min curve</p>

            <details class="quote">
              <summary>Source code in <code>src/WellClass/libs/well_pressure/pressure.py</code></summary>
              <pre class="highlight"><code class="language-python">def init_pressure_curves(self):
    '''
    Initiates Pressure table for the wellbore
    By default creates a hydrostatic gradient curve and a Sh min curve
    '''

    #Calculate depth, temp(depth) hydrostatic_pressure(depth), H2ORHO(depth for hydrostatic pressure)
    init_curves = get_hydrostatic_P(self.header, pvt_path=self.pvt_path) 

    #Include Minimum horizontal stress
    init_curves = _get_shmin(self.header, init_curves)

    #Store tables in main pressure_CO2 table 
    self.init_curves = init_curves</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.WellClass.libs.well_pressure.pressure.Pressure.check_init_pressure" class="doc doc-heading">
            <code class="highlight language-python">check_init_pressure()</code>

<a href="#src.WellClass.libs.well_pressure.pressure.Pressure.check_init_pressure" class="headerlink" title="Permanent link"></a></h4>


    <div class="doc doc-contents ">

        <p>Calculates hydrostatic pressure at reservoir_P['depth_msl'] and stores it in reservoir_P['hydrostatic_pressure']</p>
<p>reservoir_pressure            <br />
depth_msl       RP1     RP2
2238                    20</p>
<p>then P_init['depth_msl'] is the reference depth 2238</p>
<p>Also delta-pressures RP1 and RP2 are read and used later for leakage calculations. (self.reservoir_P[])</p>


<details class="note" open>
  <summary>The interpretation of the numbers set for RP1 and RP2 is a bit unclear.</summary>
  <p>RP means reservoir pressure - but for the current implementation 
it is interpreted as delta pressure: delta wrt hydrostatic pressure. 
Initial implementation had the possibility to have absolute pressure AND a delta-pressure. But the delta-pressure had to be 
given as a string "+ 20" or "- 15". Bit the + and - tended to create problems. 
So alternatively one could distingwuish between RP and DP  if it is important to give in absolute pressure as well.
But the most interesting input IS actually the change in pressure compared with hydrostatic pressure.</p>
</details>
            <details class="quote">
              <summary>Source code in <code>src/WellClass/libs/well_pressure/pressure.py</code></summary>
              <pre class="highlight"><code class="language-python">def check_init_pressure(self):
    '''
    Calculates hydrostatic pressure at reservoir_P['depth_msl'] and stores it in reservoir_P['hydrostatic_pressure']

    reservoir_pressure		
    depth_msl	RP1	RP2
    2238		        20

    then P_init['depth_msl'] is the reference depth 2238

    Also delta-pressures RP1 and RP2 are read and used later for leakage calculations. (self.reservoir_P[])

    Note: The interpretation of the numbers set for RP1 and RP2 is a bit unclear. 
          RP means reservoir pressure - but for the current implementation 
          it is interpreted as delta pressure: delta wrt hydrostatic pressure. 
          Initial implementation had the possibility to have absolute pressure AND a delta-pressure. But the delta-pressure had to be 
          given as a string "+ 20" or "- 15". Bit the + and - tended to create problems. 
          So alternatively one could distingwuish between RP and DP  if it is important to give in absolute pressure as well.
          But the most interesting input IS actually the change in pressure compared with hydrostatic pressure.

    '''
    # If no reservoir pressure is given, then we assume the reservoir is at the CO2 datum
    if self.reservoir_P is None:
        self.reservoir_P = {'depth_msl': self.co2_datum}

    #Get initial pressure table from reservoir_P dictionary
    P_init = self.reservoir_P

    # Get reference depth from reservoir_P, e.g. top reservoir
    ref_z        = P_init['depth_msl']                       


    #Hydrostatic pressure at reference depth (ref_z)
    ref_p        = np.interp(ref_z, self.init_curves['depth_msl'], self.init_curves[ 'hs_p'])
    print(f"Hydrostatic pressure at reference depth {ref_z:.0f} is {ref_p:.2f}")

    #Store value in reservoir_P table
    self.reservoir_P['hydrostatic_pressure'] = float(ref_p)</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.WellClass.libs.well_pressure.pressure.Pressure.check_scenarios_from_input" class="doc doc-heading">
            <code class="highlight language-python">check_scenarios_from_input()</code>

<a href="#src.WellClass.libs.well_pressure.pressure.Pressure.check_scenarios_from_input" class="headerlink" title="Permanent link"></a></h4>


    <div class="doc doc-contents ">

        <p>Reads input scenarios and creates a dictionary of scenarios to compute pressures for</p>

            <details class="quote">
              <summary>Source code in <code>src/WellClass/libs/well_pressure/pressure.py</code></summary>
              <pre class="highlight"><code class="language-python">def check_scenarios_from_input(self):
    '''
    Reads input scenarios and creates a dictionary of scenarios to compute pressures for
    '''
    #Initialize dictionary of scenarios
    self._init_pressure_scenarios_dict()

    MAX_PRESSURE_NAME = 'max_p'

    #Get hydrostatic pressure at reservoir depth
    ref_p = self.reservoir_P['hydrostatic_pressure']

    #Compute number of scenarios
    n_scenarios = max(len(self.reservoir_P)-2, 0)

    #Initialize scenario counter
    scenario_counter = 0

    #If no scenarios are given, then we have at least one scenario: hydrostatic pressure
    self._add_hydrostatic_scenario(scenario_counter, ref_p)

    #Increment scenario counter
    scenario_counter += 1

    #Iterate over input scenarios
    if n_scenarios &gt; 0:
        scenario_counter = self._add_input_scenarios(scenario_counter, ref_p)

    #Iterate over maximum pressure scenarios
    if not self.max_pressure_pos is None:
        self._add_max_pressure_scenarios(scenario_counter, MAX_PRESSURE_NAME)</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.WellClass.libs.well_pressure.pressure.Pressure.compute_barrier_leakage" class="doc doc-heading">
            <code class="highlight language-python">compute_barrier_leakage(well: Well, barrier_name: str) -&gt; pd.DataFrame</code>

<a href="#src.WellClass.libs.well_pressure.pressure.Pressure.compute_barrier_leakage" class="headerlink" title="Permanent link"></a></h4>


    <div class="doc doc-contents ">

        <p>Compute leakage rate from the given barrier</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code>well</code></b>
              (<code><a class="autorefs autorefs-internal" title="src.WellClass.libs.well_class.well_class.Well" href="../well_class/#src.WellClass.libs.well_class.well_class.Well">Well</a></code>)
          –
          <div class="doc-md-description">
            <p>well information</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code>barrier_name</code></b>
              (<code>str</code>)
          –
          <div class="doc-md-description">
            <p>barrier to check the leakage rate</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>src/WellClass/libs/well_pressure/pressure.py</code></summary>
              <pre class="highlight"><code class="language-python">def compute_barrier_leakage(self, well: Well, barrier_name: str) -&gt; pd.DataFrame:
    """ Compute leakage rate from the given barrier

        Args:
            well (Well): well information
            barrier_name (str): barrier to check the leakage rate
    """
    if well.inventory['barriers']:
        # for convenience
        barrier_perm = well.barrier_perm

        # barrier geometries
        barrier_props = well.compute_barrier_props(barrier_name)

        # Estimate CO2 leakage in [tons/day] after a trancient period
        barrier_leakage = compute_barrier_leakage(barrier_perm, self.pressure_scenarios, self.pressure_CO2, barrier_props)

        return barrier_leakage

    else:
        print(f'No barriers declared in well {well.header["well_name"]}')</code></pre>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["search.suggest", "search.highlight", "content.tabs.link", "navigation.indexes", "content.tooltips", "navigation.path", "content.code.annotate", "content.code.copy", "content.code.select"], "search": "../../../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.56dfad97.min.js"></script>
      
    
  </body>
</html>